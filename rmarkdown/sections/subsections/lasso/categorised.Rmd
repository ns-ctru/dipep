##### Pre-Categorised Continuous Variables

```{r results_lasso_categorical, echo = FALSE, cache = FALSE, warning = FALSE, message = FALSE, results = 'hide', eval = TRUE}
classification <- 'first.st'
predictor <- c('age.cat', 'bmi.cat', 'smoking.cat', 'pregnancies.over.cat', 'pregnancies.under.cat',
               'history.thrombosis', 'history.veins', 'history.iv.drug', 'thrombo', 'cesarean',
               'injury', 'thrombosis', 'existing.medical',
               ## 'preg.post',
               'trimester', 'multiple.preg',
               'travel', 'immobil', 'this.pregnancy.problems', 'prev.preg.problem',
               'presenting.features.pleuritic', 'presenting.features.non.pleuritic',
               'presenting.features.sob.exertion', 'presenting.features.sob.rest',
               'presenting.features.haemoptysis', 'presenting.features.cough',
               'presenting.features.syncope',
               ## 'presenting.features.palpitations',
               'presenting.features.other', 'respiratory.rate.cat', 'heart.rate.cat',
               'o2.saturation.cat', 'bp.systolic.cat', 'bp.diastolic.cat', 'ecg.cat', 'xray.cat')
lasso.categorical <- dipep_glmnet_orig(df          = dipep,
                                       classification = classification,
                                       predictor      = predictor,
                                       alpha          = 1,
                                       model          = 'LASSO : Pre-Categorised Variables',
                                       exclude        = NULL,
                                       exclude.non.recruited = TRUE,
                                       exclude.dvt           = TRUE,
                                       exclude.anti.coag     = FALSE,
                                       legend                = TRUE,
                                       threshold             = 0.3)

```



```{r results_lasso_categorical_plot, echo = FALSE, cache = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 10, results = 'asis', eval = TRUE}
## Plot the change in coefficients over time
lasso.categorical$lasso.plot + guides(colour = FALSE)

```

###### Cross-Validation

[Leave One Out Cross-validation](https://en.wikipedia.org/wiki/Cross-validation_(statistics)#Leave-one-out_cross-validation) has been utilised internally at each step of the fitting of the LASSO to shrink the point estimate and inform the next iteration.  The model should not be over-fitted though and this can be achieved by considering the parameter Lambda and either taking the minimum value or the value corresponding 1 x SE of the point-estimate of the Mean Squared Error **ToDo** - Check this explanation.

<!--- Partial explanation at http://stats.stackexchange.com/questions/77546/how-to-interpret-glmnet --->

```{r results_lasso_categorical_cross_validation_plot, echo = FALSE, cache = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 10, results = 'asis', eval = TRUE}
lasso.categorical$lasso.cv.plot

```

###### Sensitivity and Specificity

Having selected an optimal value for Lambda the predicted probabilities are then obtained and ROC curves plotted along with the calculated Area Under the Curve (AUC) statistic.  A cut-point for probability can be chosen and we can **ToDo** [Calculate sensitivity/specificity/PPV/NPV from glmnet object](https://stackoverflow.com/questions/35482094/glmnet-caret-roc-sensitivity-specificity-of-training-model)

```{r results_lasso_categorical_roc, echo = FALSE, cache = FALSE, warning = FALSE, message = FALSE,  fig.width = 10,fig.height = 10, results = 'markup', eval = TRUE}
lasso.categorical$lasso.cv.roc
lasso.categorical$lasso.cv.summary.stats %>%
    kable(caption = 'AUC for Cross-Validated LASSO for varying Lambda thresholds.')
lasso.categorical$lasso.cv.coef.lambda %>%
    kable(caption = 'Coefficients for Lambda thresholds.')

```

The question naturally arises as to whether a parsimonious model with less variables from an earlier stage in the LASSO can be used without losing predictive ability of the model.  It is self-evident that simpler models will have poorer predictive value because they use less information in order to make the prediction, but in order to provide a visual overview and numerical quantification of the trade-off between complexity and predictive value *all* steps from the LASSO are plotted as ROC curves and goodness of fit statistics have been calculated for each sequential step.


```{r results_lasso_categorical_roc_all, echo = FALSE, cache = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 10, results = 'asis', eval = TRUE}
lasso.categorical$lasso.cv.roc.all
lasso.categorical$lasso.cv.summary.stats.all %>%
    kable(caption = paste0('Predictive statistics for sequential steps of LASSO using a cut-point of p = ',
                           lasso.categorical$threshold,
                           '.'))

```
