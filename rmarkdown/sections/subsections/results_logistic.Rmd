### Logistic Regression {.tabset .tabset-fade .tabset-pills}

```{r results_logistic_regression, echo = FALSE, cache = FALSE, warning = FALSE, message = FALSE, results = 'hide', eval = TRUE}
## Test each outcome for association, then gather them (using broom) into one dataset for summarisation
logistic <- list()
## Age
logistic$age <- dipep_glm(df = dipep,
                          classification = 'first.st',
                          predictor      = 'age',
                          model          = 'Age',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Age (Categorised)
logistic$age.cat <- dipep_glm(df = dipep,
                              classification = 'first.st',
                              predictor = 'age.cat',
                              model     = 'Age (Binary)',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Smoking
logistic$smoking <- dipep_glm(df = dipep,
                              classification = 'first.st',
                              predictor = 'smoking',
                              model = 'Smoking',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Temperature (Categorised)
logistic$temperature.cat <- dipep_glm(df        = dipep,
                                      classification = 'first.st',
                                      predictor = 'temperature.cat',
                                      model     = 'Temperature (Binary)',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Temperature
logistic$temperature <- dipep_glm(df            = dipep,
                                  classification = 'first.st',
                                  predictor     = 'temperature',
                                  model         = 'Temperature',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## BP Diastolic (Categorised)
logistic$bp.diastolic.cat <- dipep_glm(df        = dipep,
                                       classification = 'first.st',
                                       predictor = 'bp.diastolic.cat',
                                       model     = 'Diastolic BP (Binary)',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## BP Diastolic
logistic$bp.diastolic <- dipep_glm(df        = dipep,
                                   classification = 'first.st',
                                   predictor = 'bp.diastolic',
                                   model     = 'Diastolic BP',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## BP Systolic (Categorised)
logistic$bp.systolic.cat <- dipep_glm(df = dipep,
                                      classification = 'first.st',
                                      predictor = 'bp.systolic.cat',
                                      model     = 'Systolic BP (Binary)',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## BP Systolic
logistic$bp.systolic <- dipep_glm(df = dipep,
                                  classification = 'first.st',
                                  predictor = 'bp.systolic',
                                  model     = 'Systolic BP',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## O2 Saturation (Categorised)
logistic$o2.saturation.cat <- dipep_glm(df = dipep,
                                        classification = 'first.st',
                                        predictor = 'o2.saturation.cat',
                                        model = 'O2 Saturation (Binary)',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## O2 Saturation
logistic$o2.saturation <- dipep_glm(df = dipep,
                                    classification = 'first.st',
                                    predictor = 'o2.saturation',
                                    model = 'O2 Saturation',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Respiratory Rate (Categorised)
logistic$respiratory.rate.cat <- dipep_glm(df = dipep,
                                           classification = 'first.st',
                                           predictor = 'respiratory.rate.cat',
                                           model = 'Respiratory Rate (Binary)',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Respiratory Rate
logistic$respiratory.rate <- dipep_glm(df = dipep,
                                       classification = 'first.st',
                                       predictor = 'respiratory.rate',
                                       model = 'Respiratory Rate',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Heart Rate (Categorised)
logistic$heart.rate.cat <- dipep_glm(df = dipep,
                                     classification = 'first.st',
                                     predictor = 'heart.rate.cat',
                                     model = 'Heart Rate (Binary)',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Heart Rate
logistic$heart.rate <- dipep_glm(df = dipep,
                                 classification = 'first.st',
                                 predictor = 'heart.rate',
                                 model = 'Heart Rate',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## BMI (Categorised)
logistic$bmi.cat <- dipep_glm(df = dipep,
                              classification = 'first.st',
                              predictor = 'bmi.cat',
                              model = 'BMI (Binary)',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## BMI
logistic$bmi <- dipep_glm(df = dipep,
                          classification = 'first.st',
                          predictor = 'bmi',
                          model = 'BMI',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Previous Pregnancies < 24 weeks
logistic$pregnancies.under <- dipep_glm(df = dipep,
                                        classification = 'first.st',
                                        predictor = 'pregnancies.under',
                                        model = 'Pregnancies <= 24',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Previous Pregnancies < 24 weeks (Categorised)
logistic$pregnancies.under.cat <- dipep_glm(df = dipep,
                                        classification = 'first.st',
                                        predictor = 'pregnancies.under.cat',
                                        model = '>= 1 Pregnancy <= 24',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Previous Pregnancies > 24 weeks
logistic$pregnancies.over <- dipep_glm(df = dipep,
                                       classification = 'first.st',
                                       predictor = 'pregnancies.over',
                                       model = 'Pregnancies >= 24',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Previous Pregnancies > 24 weeks (Categorised)
logistic$pregnancies.over.cat <- dipep_glm(df = dipep,
                                       classification = 'first.st',
                                       predictor = 'pregnancies.over.cat',
                                       model = '>= 1 Pregnancy >= 24',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Previous Pregnancy Problems
logistic$prev.preg.problem <- dipep_glm(df = dipep,
                                        classification = 'first.st',
                                        predictor = 'prev.preg.problem',
                                        model = 'Previous Pregnancy Problems',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Pleuritic
logistic$presenting.features.pleuritic <- dipep_glm(df = dipep,
                                                    classification = 'first.st',
                                                    predictor = 'presenting.features.pleuritic',
                                                    model = 'Pleuritic',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Non-Pleuritic
logistic$presenting.features.non.pleuritic <- dipep_glm(df = dipep,
                                                        classification = 'first.st',
                                                        predictor = 'presenting.features.non.pleuritic',
                                                        model = 'Non-Pleuritic',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Shortness of Breath (Exertion)
logistic$presenting.features.sob.exertion <- dipep_glm(df = dipep,
                                                       classification = 'first.st',
                                                       predictor = 'presenting.features.sob.exertion',
                                                       model = 'Shortness of Breath (Exertion)',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Shortness of Breath (Rest)
logistic$presenting.features.sob.rest <- dipep_glm(df = dipep,
                                                   classification = 'first.st',
                                                   predictor = 'presenting.features.sob.rest',
                                                   model = 'Shortness of Breath (Rest)',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Haemoptysis
logistic$presenting.features.haemoptysis <- dipep_glm(df = dipep,
                                                      classification = 'first.st',
                                                      predictor = 'presenting.features.haemoptysis',
                                                      model = 'Haemoptysis',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Cough
logistic$presenting.features.cough <- dipep_glm(df = dipep,
                                                classification = 'first.st',
                                                predictor = 'presenting.features.cough',
                                                model = 'Cough',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Syncope
logistic$presenting.features.syncope <- dipep_glm(df = dipep,
                                                  classification = 'first.st',
                                                  predictor = 'presenting.features.syncope',
                                                  model = 'Syncope',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Clinical DVT
logistic$dvt.cat <- dipep_glm(df = dipep,
                                                  classification = 'first.st',
                                                  predictor = 'dvt.cat',
                                                  model = 'Clinical DVT',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Palpitations
logistic$presenting.features.palpitations <- dipep_glm(df = dipep,
                                                       classification = 'first.st',
                                                       predictor = 'presenting.features.palpitations',
                                                       model = 'Palpitations',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Other Features on Presentation
logistic$presenting.features.other <- dipep_glm(df = dipep,
                                                classification = 'first.st',
                                                predictor = 'presenting.features.other',
                                                model = 'Other',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Surgery
logistic$surgery <- dipep_glm(df = dipep,
                              classification = 'first.st',
                              predictor = 'surgery',
                              model = 'Surgery',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Family history of thrombosis
logistic$history.thrombosis <- dipep_glm(df = dipep,
                                         classification = 'first.st',
                                         predictor = 'history.thrombosis',
                                         model = 'Family History of Thrombosis',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## History of varicoseveins
logistic$history.veins <- dipep_glm(df = dipep,
                                    classification = 'first.st',
                                    predictor = 'history.veins',
                                    model =  'Varicose Veins',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## History of IV Drug use
logistic$history.iv.drug <- dipep_glm(df = dipep,
                                      classification = 'first.st',
                                      predictor = 'history.iv.drug',
                                      model = 'History of IV Drug Use',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Thrombosis
logistic$thrombosis <- dipep_glm(df = dipep,
                                 classification = 'first.st',
                                 predictor = 'thrombosis',
                                 model = 'History of Thrombosis',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Trimester
logistic$trimester <- dipep_glm(df = dipep,
                                classification = 'first.st',
                                predictor = 'trimester',
                                model = 'Trimester',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Problems with this pregnancy
logistic$this.pregnancy.problems <- dipep_glm(df = dipep,
                                              classification = 'first.st',
                                              predictor = 'this.pregnancy.problems',
                                              model = 'Problems During This Pregnancy',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Problems with this pregnancy including other
logistic$this.pregnancy.problems.incl.other <- dipep_glm(df = dipep,
                                              classification = 'first.st',
                                              predictor = 'this.pregnancy.problems.incl.other',
                                              model = 'Problems During This Pregnancy (including Other)',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Thrombo
logistic$thrombo <- dipep_glm(df = dipep,
                              classification = 'first.st',
                              predictor = 'thrombo',
                              model = 'Known Thrombophilia',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Multiple Pregnancy
logistic$multiple.preg <- dipep_glm(df = dipep,
                                    classification = 'first.st',
                                    predictor = 'multiple.preg',
                                    model = 'Multiple Pregnancy',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Travel
logistic$travel <- dipep_glm(df = dipep,
                             classification = 'first.st',
                             predictor = 'travel',
                             model = 'Long-haul travel during pregnancy',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Immobility
logistic$immobil <- dipep_glm(df = dipep,
                              classification = 'first.st',
                              predictor = 'immobil',
                              model = '>=3 days Immobility/bed rest during pregnancy',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## ECG (Categorised)
## logistic$ecg.cat <- dipep_glm(df = dipep,
##                               classification = 'first.st',
##                               predictor = 'ecg.cat',
##                               model = 'ECG (Binary)',
##                     exclude = NULL,
##                     exclude.dvt = TRUE,
##                     exclude.non.recruited = TRUE)
## ECG (PE Related)
logistic$ecg.pe <- dipep_glm(df = dipep,
                          classification = 'first.st',
                          predictor = 'ecg.pe',
                          model = 'ECG (PE Related)',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## X-Ray (Categorised)
## logistic$xray.cat <- dipep_glm(df = dipep,
##                                classification = 'first.st',
##                                predictor = 'xray.cat',
##                                model = 'X-Ray (Binary)',
##                     exclude = NULL,
##                     exclude.dvt = TRUE,
##                     exclude.non.recruited = TRUE)
## X-Ray
logistic$xray.pe <- dipep_glm(df = dipep,
                           classification = 'first.st',
                           predictor = 'xray.pe',
                           model = 'X-Ray (PE Related)',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Thromboprophylaxis (Categorised)
logistic$thromboprophylaxis <- dipep_glm(df = dipep,
                                         classification = 'first.st',
                                         predictor = 'thromboprophylaxis',
                                         model = 'Thromboprophylaxis',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Injury
logistic$injury <- dipep_glm(df = dipep,
                             classification = 'first.st',
                             predictor = 'injury',
                             model = 'Significant Injury',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Medical problems
logistic$medical.probs <- dipep_glm(df = dipep,
                                    classification = 'first.st',
                                    predictor = 'medical.probs',
                                    model = 'Other Previous Medical Problems',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)
## Thrombotic Event this pregnancy
logistic$thromb.event <- dipep_glm(df = dipep,
                                    classification = 'first.st',
                                    predictor = 'thromb.event',
                                    model = 'Other Thrombotic events during this pregnancy',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)

## Combine all three sets of tidied output from each model
logistic$tidied <- rbind(logistic$age$tidied,
                         logistic$age.cat$tidied,
                         logistic$smoking$tidied,
                         logistic$temperature.cat$tidied,
                         logistic$temperature$tidied,
                         logistic$bp.diastolic.cat$tidied,
                         logistic$bp.diastolic$tidied,
                         logistic$bp.systolic.cat$tidied,
                         logistic$bp.systolic$tidied,
                         logistic$o2.saturation.cat$tidied,
                         logistic$o2.saturation$tidied,
                         logistic$respiratory.rate.cat$tidied,
                         logistic$respiratory.rate$tidied,
                         logistic$heart.rate.cat$tidied,
                         logistic$heart.rate$tidied,
                         logistic$bmi.cat$tidied,
                         logistic$bmi$tidied,
                         logistic$pregnancies.under$tidied,
                         logistic$pregnancies.under.cat$tidied,
                         logistic$pregnancies.over$tidied,
                         logistic$pregnancies.over.cat$tidied,
                         logistic$prev.preg.problem$tidied,
                         logistic$presenting.features.pleuritic$tidied,
                         logistic$presenting.features.non.pleuritic$tidied,
                         logistic$presenting.features.sob.exertion$tidied,
                         logistic$presenting.features.sob.rest$tidied,
                         logistic$presenting.features.haemoptysis$tidied,
                         logistic$presenting.features.cough$tidied,
                         logistic$presenting.features.syncope$tidied,
                         logistic$presenting.features.palpitations$tidied,
                         logistic$presenting.features.other$tidied,
                         logistic$surgery$tidied,
                         logistic$history.thrombosis$tidied,
                         logistic$history.veins$tidied,
                         logistic$history.iv.drug$tidied,
                         logistic$thrombosis$tidied,
                         logistic$trimester$tidied,
                         logistic$this.pregnancy.problems$tidied,
                         logistic$this.pregnancy.problems.incl.other$tidied,
                         logistic$thrombo$tidied,
                         logistic$multiple.preg$tidied,
                         logistic$travel$tidied,
                         logistic$immobil$tidied,
                         ## logistic$ecg$tidied,
                         ## logistic$ecg.cat$tidied,
                         logistic$ecg.pe$tidied,
                         ## logistic$xray$tidied,
                         ## logistic$xray.cat$tidied,
                         logistic$dvt.cat$tidied,
                         logistic$xray.pe$tidied,
                         logistic$injury$tidied,
                         logistic$medical.probs$tidied,
                         logistic$thromb.event$tidied,
                         logistic$thromboprophylaxis$tidied)
logistic$glance <- rbind(logistic$age$glance,
                         logistic$smoking$glance,
                         logistic$temperature.cat$glance,
                         logistic$temperature$glance,
                         logistic$bp.diastolic.cat$glance,
                         logistic$bp.diastolic$glance,
                         logistic$bp.systolic.cat$glance,
                         logistic$bp.systolic$glance,
                         logistic$o2.saturation.cat$glance,
                         logistic$o2.saturation$glance,
                         logistic$respiratory.rate.cat$glance,
                         logistic$respiratory.rate$glance,
                         logistic$heart.rate.cat$glance,
                         logistic$heart.rate$glance,
                         logistic$bmi.cat$glance,
                         logistic$bmi$glance,
                         logistic$pregnancies.under$glance,
                         logistic$pregnancies.under.cat$glance,
                         logistic$pregnancies.over$glance,
                         logistic$pregnancies.over.cat$glance,
                         logistic$prev.preg.problem$glance,
                         logistic$presenting.features.pleuritic$glance,
                         logistic$presenting.features.non.pleuritic$glance,
                         logistic$presenting.features.sob.exertion$glance,
                         logistic$presenting.features.sob.rest$glance,
                         logistic$presenting.features.haemoptysis$glance,
                         logistic$presenting.features.cough$glance,
                         logistic$presenting.features.syncope$glance,
                         logistic$presenting.features.palpitations$glance,
                         logistic$presenting.features.other$glance,
                         logistic$surgery$glance,
                         logistic$history.thrombosis$glance,
                         logistic$history.veins$glance,
                         logistic$history.iv.drug$glance,
                         logistic$thrombosis$glance,
                         logistic$trimester$glance,
                         logistic$this.pregnancy.problems$glance,
                         logistic$this.pregnancy.problems.incl.other$glance,
                         logistic$thrombo$glance$glance,
                         logistic$multiple.preg$glance,
                         logistic$travel$glance,
                         logistic$immobil$glance,
                         ## logistic$ecg$glance,
                         ## logistic$ecg.cat$glance,
                         logistic$ecg.pe$glance,
                         ## logistic$xray$glance,
                         ## logistic$xray.cat$glance,
                         logistic$xray.pe$glance,
                         logistic$dvt.cat$glance,
                         logistic$injury$glance,
                         logistic$medical.probs$glance,
                         logistic$thromb.event$glance,
                         logistic$thromboprophylaxis$glance)
## Combine all predicted
logistic$predicted <- rbind(logistic$age$predicted,
                            logistic$age.cat$predicted,
                            logistic$smoking$predicted,
                            logistic$temperature$predicted,
                            logistic$temperature.cat$predicted,
                            logistic$bp.diastolic$predicted,
                            logistic$bp.diastolic.cat$predicted,
                            logistic$bp.systolic$predicted,
                            logistic$bp.systolic.cat$predicted,
                            logistic$o2.saturation$predicted,
                            logistic$o2.saturation.cat$predicted,
                            logistic$respiratory.rate$predicted,
                            logistic$respiratory.rate.cat$predicted,
                            logistic$heart.rate$predicted,
                            logistic$heart.rate.cat$predicted,
                            logistic$bmi$predicted,
                            logistic$bmi.cat$predicted,
                            logistic$pregnancies.under$predicted,
                            logistic$pregnancies.under.cat$predicted,
                            logistic$pregnancies.over$predicted,
                            logistic$pregnancies.over.cat$predicted,
                            logistic$prev.preg.problem$predicted,
                            logistic$presenting.features.pleuritic$predicted,
                            logistic$presenting.features.non.pleuritic$predicted,
                            logistic$presenting.features.sob.rest$predicted,
                            logistic$presenting.features.sob.exertion$predicted,
                            logistic$presenting.features.haemoptysis$predicted,
                            logistic$presenting.features.cough$predicted,
                            logistic$presenting.features.syncope$predicted,
                            logistic$presenting.features.palpitations$predicted,
                            logistic$presenting.features.other$predicted,
                            logistic$surgery$predicted,
                            logistic$history.thrombosis$predicted,
                            logistic$history.veins$predicted,
                            logistic$history.iv.drug$predicted,
                            logistic$thrombosis$predicted,
                            logistic$trimester$predicted,
                            logistic$this.pregnancy.problems$predicted,
                            logistic$this.pregnancy.problems.incl.other$predicted,
                            logistic$thrombo$predicted,
                            logistic$multiple.preg$predicted,
                            logistic$travel$predicted,
                            logistic$immobil$predicted,
                            ## logistic$ecg$predicted,
                            ## logistic$ecg.cat$predicted,
                            logistic$ecg.pe$predicted,
                            ## logistic$xray.cat$predicted,
                            ## logistic$xray$predicted,
                            logistic$xray.pe$predicted,
                            logistic$dvt.cat$predicted,
                            logistic$injury$predicted,
                            logistic$medical.probs$predicted,
                            logistic$thromb.event$predicted,
                            logistic$thromboprophylaxis$predicted)
## Remove 'presenting.features.' from name
logistic$predicted <- mutate(logistic$predicted,
                             name = gsub('presenting.features.', '', name))
## Combine cross-tabulation for all categorical models
logistic$cross.tab <- rbind(logistic$age.cat$table,
                            logistic$smoking$table,
                            logistic$temperature.cat$table,
                            logistic$bp.diastolic.cat$table,
                            logistic$bp.systolic.cat$table,
                            logistic$o2.saturation.cat$table,
                            logistic$respiratory.rate.cat$table,
                            logistic$heart.rate.cat$table,
                            logistic$bmi.cat$table,
                            logistic$pregnancies.under.cat$table,
                            logistic$pregnancies.over.cat$table,
                            logistic$prev.preg.problem$table,
                            logistic$presenting.features.pleuritic$table,
                            logistic$presenting.features.non.pleuritic$table,
                            logistic$presenting.features.sob.rest$table,
                            logistic$presenting.features.sob.exertion$table,
                            logistic$presenting.features.haemoptysis$table,
                            logistic$presenting.features.cough$table,
                            logistic$presenting.features.syncope$table,
                            logistic$presenting.features.palpitations$table,
                            logistic$presenting.features.other$table,
                            logistic$surgery$table,
                            logistic$history.thrombosis$table,
                            logistic$history.veins$table,
                            logistic$history.iv.drug$table,
                            logistic$thrombosis$table,
                            logistic$thromboprophylaxis$table,
                            logistic$trimester$table,
                            logistic$this.pregnancy.problems$table,
                            logistic$this.pregnancy.problems.incl.other$table,
                            logistic$thrombo$table,
                            logistic$multiple.preg$table,
                            logistic$travel$table,
                            logistic$immobil$table,
                            ## logistic$ecg$table,
                            logistic$ecg.pe$table,
                            ## logistic$xray$table,
                            logistic$xray.pe$table,
                            logistic$dvt.cat$table,
                            logistic$injury$table,
                            logistic$thromb.event$table,
                            logistic$medical.probs$table)
## Saturated
logistic$saturated <- dipep_glm(df = dipep,
                                classification = 'first.st',
                                predictor = c('age', 'bmi', 'temperature', 'bp.diastolic', 'bp.systolic',
                                              'o2.saturation', 'respiratory.rate', 'heart.rate', 'smoking',
                                              'prev.preg.problem', 'pregnancies.under', 'pregnancies.over',
                                              'presenting.features.pleuritic', 'presenting.features.non.pleuritic',
                                              'presenting.features.sob.rest', 'presenting.features.sob.exertion',
                                              'presenting.features.cough', 'presenting.features.haemoptysis',
                                              'presenting.features.syncope', 'presenting.features.palpitations',
                                              'presenting.features.other', 'surgery',
                                              ## 'injury', 'medical.probs', 'medical.complication', 'obstetric.complication',
                                              'history.thrombosis', 'history.veins', ## 'history.iv.drug',
                                              'thrombosis', 'trimester', 'this.pregnancy.problems',
                                              'thrombo', 'multiple.preg', 'immobil', ## 'travel',
                                              'ecg.cat', 'xray.cat'),
                                model = 'Saturated Multivariable Logistic Model',
                    exclude = NULL,
                    exclude.dvt = TRUE,
                    exclude.non.recruited = TRUE,
                    exclude.missing       = FALSE)


```

#### Univariable Regression

Its is not advisable to use the results of univariable regression to shape your choice of variables to include in multi-variable models for the simple reason that the coefficients obtained for a variable in isolation will not be the same as those from a multi-variable model.  Thus something that appears to be significant under univariable analysis may well not be under multi-variable analysis.  A better strategy is to use expert clinical knowledge as to what factors are important to determine which variables are included in a multi-variable model.

Regardless each of the individual variables has been analysed under a univariable logistic regression model.  The coefficients, their confidence intervals, the sensitivity, specificity and area under the receiver operating characeristics curve are tabulated below.  **For detailed output of each univariable logistic regression model please refer to the [Appendix](dipep.html#section-appendix)**.


##### Point Estimates

The point-estimate and 95% Confidence Intervals from univariable logistic regression are plotted and tabulated below.  Both raw continuous and categorised variables are included to provide comparison.


```{r results_logistic_regression_summary, echo = FALSE, cache = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 10, results = 'markup', eval = TRUE}
to.sum <- dplyr::filter(logistic$tidied, term != '(Intercept)') %>%
          ## Remove temperature and O2 Saturation as CI is HUGE
          ## dplyr::filter(term != 'Temperature (High)') %>%
          ## dplyr::filter(term != 'O2 Saturation (High)') %>%
    dplyr::select(term, estimate, lci, uci, p.value)
## Select the results from logistic regression of Existing scores for combininig
to.sum.delphi <- dplyr::filter(existing$tidied, term != '(Intercept)') %>%
                 dplyr::filter(term %in% c('Delphi : Medical History (Hospital Admission, Surgery or Injury)',
                                           'Delphi : Surgery (excl. Cesarean)',
                                           'Delphi : Medical Complications',
                                           'Delphi : Obstetric Complications',
                                           'Delphi : Gestation')) %>%
                 dplyr::select(term, estimate, lci, uci, p.value)
to.sum.simplified <- dplyr::filter(existing$tidied, term != '(Intercept)') %>%
                     dplyr::filter(term %in% c(## 'Geneva : Neoplasm',
                                               'Geneva : Unilateral lower limb pain',
                                               'Geneva : Pain on limb palpitation')) %>%
                     dplyr::select(term, estimate, lci, uci, p.value)
to.sum.wells <- dplyr::filter(existing$tidied, term != '(Intercept)') %>%
                dplyr::filter(term %in% c(## 'Wells : Neoplasm',
                                            'Wells : PE most likely diagnosis (Permissive)',
                                            'Wells : PE most likely diagnosis (Strict)')) %>%
                     dplyr::select(term, estimate, lci, uci, p.value)
to.sum.perc <- dplyr::filter(existing$tidied, term != '(Intercept)') %>%
                     dplyr::filter(term %in% c('PERC : Exogenous Estrogen',
                                               'PERC : Unilateral Leg Swelling',
                                               'PERC : Previous DVT/PE')) %>%
                     dplyr::select(term, estimate, lci, uci, p.value)
to.sum.ddimer.all <- dplyr::filter(biomarker.all$tidied, term != '(Intercept)') %>%
                     dplyr::filter(term %in% c('D-Dimer (Hospital Gestation Specific) : Abnomral',
                                               'D-Dimer (Hospital) : Abnormal')) %>%
                     mutate(term = paste0(term, ' - All')) %>%
                     dplyr::select(term, estimate, lci, uci, p.value)
to.sum.ddimer.excl.anti.coag <- dplyr::filter(biomarker.excl.anti.coag$tidied, term != '(Intercept)') %>%
                                dplyr::filter(term %in% c('D-Dimer (Hospital) : Abnormal',
                                                          'D-Dimer (Hospital Gestation Specific) : Abnormal')) %>%
                     mutate(term = paste0(term, ' - Excluding those on Anti-Coagulants')) %>%
                     dplyr::select(term, estimate, lci, uci, p.value)
to.sum <- rbind(to.sum,
                to.sum.delphi,
                to.sum.simplified,
                to.sum.wells,
                to.sum.perc,
                to.sum.ddimer.all)
                ## to.sum.ddimer.excl.anti.coag)
ggplot(to.sum, aes(term, estimate, colour = term)) +
    geom_point() + geom_errorbar(aes(ymin = lci, ymax = uci)) +
    coord_flip() + geom_hline(yintercept = 0) +
    xlab('Predictor') + ylab('Estimate') +
    ggtitle('Point Estimate and 95% CI for Univariable Logistic Regression') +
    theme_bw() + theme(legend.position = 'none')
## Redo subsetting, include temperature and O2 Saturation
to.sum <- dplyr::filter(logistic$tidied, term != '(Intercept)') %>%
          dplyr::select(term, estimate, lci, uci, p.value)
## Select the results from logistic regression of Existing scores for combininig
to.sum.delphi <- dplyr::filter(existing$tidied, term != '(Intercept)') %>%
                 dplyr::filter(term %in% c('Delphi : Medical History (Hospital Admission, Surgery or Injury)',
                                           'Delphi : Surgery (excl. Cesarean)',
                                           'Delphi : Medical Complications',
                                           'Delphi : Obstetric Complications',
                                           'Delphi : Gestation')) %>%
                 dplyr::select(term, estimate, lci, uci, p.value)
to.sum.simplified <- dplyr::filter(existing$tidied, term != '(Intercept)') %>%
                     dplyr::filter(term %in% c('Geneva : Neoplasm',
                                               'Geneva : Unilateral lower limb pain',
                                               'Geneva : Pain on limb palpitation')) %>%
                     dplyr::select(term, estimate, lci, uci, p.value)
to.sum.wells <- dplyr::filter(existing$tidied, term != '(Intercept)') %>%
                     dplyr::filter(term %in% c('Wells : PE most likely diagnosis (Permissive)',
                                               'Wells : PE most likely diagnosis (Strict)',
                                               'Wells : Neoplasm')) %>%
                     dplyr::select(term, estimate, lci, uci, p.value)
to.sum.perc <- dplyr::filter(existing$tidied, term != '(Intercept)') %>%
                     dplyr::filter(term %in% c('PERC : Exogenous Estrogen',
                                               'PERC : Unilateral Leg Swelling',
                                               'PERC : Previous DVT/PE')) %>%
                     dplyr::select(term, estimate, lci, uci, p.value)
to.sum.ddimer.all <- dplyr::filter(biomarker.all$tidied, term != '(Intercept)') %>%
                     dplyr::filter(term %in% c('D-Dimer (Hospital) : Abnormal',
                                               'D-Dimer (Hospital Gestation Specific) : Abnomral')) %>%
                     mutate(term = paste0(term, ' - All')) %>%
                     dplyr::select(term, estimate, lci, uci, p.value)
to.sum.ddimer.excl.anti.coag <- dplyr::filter(biomarker.excl.anti.coag$tidied, term != '(Intercept)') %>%
                     dplyr::filter(term %in% c('D-Dimer (Hospital) : Abnormal',
                                               'D-Dimer (Hospital Gestation Specific) : Abnormal')) %>%
                     mutate(term = paste0(term, ' - Excluding those on Anti-Coagulants')) %>%
                     dplyr::select(term, estimate, lci, uci, p.value)
to.sum <- rbind(to.sum,
                to.sum.delphi,
                to.sum.simplified,
                to.sum.wells,
                to.sum.perc,
                to.sum.ddimer.all,
                to.sum.ddimer.excl.anti.coag) %>%
          arrange(term)
names(to.sum) <- c('Term', 'Estimate', 'Lower CI', 'Upper CI', 'P-Value')
kable(to.sum,
      digits  = 3,
      caption = 'Point estimates, 95% CIs and p-values for Univariable Regression')
rm(to.sum)

```

<!-- Cross-tabulation of all categorical variables by the Primary Classification is provided in the table below. -->

```{r results_logistic_regression_cross_tab, echo = FALSE, cache = FALSE, warning = FALSE, message = FALSE, results = 'markup', eval = TRUE}
to.sum <- logistic$cross.tab
to.sum.existing <- dplyr::filter(existing$cross.tab, predictor %in% c('Delphi : Medical History (Hospital Admission, Surgery or Injury)',
                                                                      'Delphi : Surgery (excl. Cesarean)',
                                                                      'Delphi : Medical Complication',
                                                                      'Delphi : Obstetric Complication',
                                                                      'Delphi : Gestation',
                                                                      'Geneva : Neoplasm',
                                                                      'Geneva : Unilateral lower limb pain',
                                                                      'Geneva : Pain on limb palpitation',
                                                                      'Geneva : Neoplasm',
                                                                      'Wells : PE most likely diagnosis (Permissive)',
                                                                      'Wells : PE most likely diagnosis (Strict)',
                                                                      'Wells : Neoplasm',
                                                                      'PERC : Exogenous Estrogen',
                                                                      'PERC : Unilateral Leg Swelling',
                                                                      'PERC : Previous DVT/PE'))
to.sum.ddimer.all <- rbind(biomarker.all$d.dimer.cat$table,
                           biomarker.all$d.dimer.gestation.cat$table) %>%
                     mutate(predictor = paste0(predictor, ' - All'))
to.sum.ddimer.excl.anti.coag <- rbind(biomarker.excl.anti.coag$d.dimer.cat$table,
                                      biomarker.excl.anti.coag$d.dimer.gestation.cat$table) %>%
                     mutate(predictor = paste0(predictor, ' - Excluding those on Anti-Coagualnts'))
to.tab <- rbind(to.sum,
                to.sum.existing,
                to.sum.ddimer.all,
                to.sum.ddimer.excl.anti.coag) %>%
          mutate(predictor = gsub(' (Categorised)', '', predictor)) %>%
          arrange(predictor)
kable(to.tab,
      col.names = c('Predictor', 'Levels', 'No PE', 'PE'),
      caption   = 'Cross-tabulation of categorical predictors by Primary Classification of Pulmonary Embolism status. ')

```

##### ROC Curves

[Sensitivity and Specificity](https://en.wikipedia.org/wiki/Sensitivity_and_specificity) are not absolute since each individual is assigned a probability from the logistic regression model and it is then down to the investigator to decide what threshold ($0 < x < 1$ if not exponentiated) should be used to classify someone as having a Pulmonary Embolism.  A simple way of visualising the sensitivity and specificity for different thresholds is via a [Receiver Operating Characteristic Curve](https://en.wikipedia.org/wiki/Receiver_operating_characteristic) which plots the [false-positive rate](https://en.wikipedia.org/wiki/False_positive_rate) against the true positive rate.  The following graph shows the curves for the different univariable logistic regression models.

```{r results_logistic_regression_roc, echo = FALSE, cache = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 10, results = 'markup', eval = TRUE}
## This uses the geom_roc() ggplot2 extension from the ploROC package
## ROC for continuous variables
logistic$roc.physiology <- dipep_roc(df      = logistic$predicted,
                            to.plot = c('age',
                                        'bmi',
                                        'o2.saturation',
                                        'bp.diastolic',
                                        'bp.systolic',
                                        'temperature'),
                            title   = 'Physiology (Continuous)')
logistic$roc.physiology$plot
## Plot categorised variables
logistic$roc.physiology.cat <- dipep_roc(df      = logistic$predicted,
                                to.plot = c('age.cat',
                                            'bmi.cat',
                                            'o2.saturation.cat',
                                            'bp.diastolic.cat',
                                            'bp.systolic.cat',
                                            'temperature.cat'),
                                title   = 'Physiology (Dichotomised)')
logistic$roc.physiology.cat$plot
## Plot presenting features
logistic$roc.presenting <- dipep_roc(df      = logistic$predicted,
                            to.plot = c('pleuritic',
                                        'non.pleuritic',
                                        'sob.exertion',
                                        'sob.rest',
                                        'cough',
                                        'haemoptysis',
                                        'syncope',
                                        'palpitations',
                                        'other'),
                            title = 'Presenting Features')
logistic$roc.presenting$plot
## Plot Other
logistic$roc.other <- dipep_roc(df      = logistic$predicted,
                       to.plot = c('prev.preg.problem',
                                   'pregnancies.over',
                                   'pregnancies.under',
                                   'xray.pe',
                                   'ecg.pe',
                                   'thromboprophylaxis',
                                   'this.pregnancy.problems',
                                   'this.pregnancy.problems.incl.other',
                                   'trimester'),
                       title   = 'Other Features')
logistic$roc.other$plot
## Plot Medical History
logistic$roc.med.hist <- dipep_roc(df      = logistic$predicted,
                          to.plot = c('history.thrombosis',
                                      'history.iv.drug',
                                      'history.veins',
                                      'thrombo',
                                      'surgery',
                                      'thrombosis',
                                      'dvt.cat'),
                          title   = 'Medical History')
logistic$roc.med.hist$plot
## Plot Unique Delphi components
existing$roc.delphi <- dipep_roc(df      = existing$predicted,
                          to.plot = c('delphi.medical.history',
                                      'delphi.medical.history.surgery',
                                      'delphi.medical.complication',
                                      'delphi.obstetric.complication',
                                      'delphi.gestation'),
                          title   = 'Unique Delphi Score Components')
existing$roc.delphi$plot
## Plot Unique Geneva components
existing$roc.simplified <- dipep_roc(df      = existing$predicted,
                          to.plot = c('simplified.neoplasm',
                                      'simplified.lower.limb.unilateral.pain',
                                      'simplified.pain.palpitations'),
                          title   = 'Unique GENEVA Score Components')
existing$roc.simplified$plot
## Plot Unique PERC components
existing$roc.wells <- dipep_roc(df      = existing$predicted,
                          to.plot = c('wells.alternative.permissive',
                                      'wells.alternative.strict'),
                          title   = 'Unique PERC Score Components')
existing$roc.wells$plot
## Plot Unique Wells components
existing$roc.perc <- dipep_roc(df      = existing$predicted,
                          to.plot = c('perc.hormone',
                                      'perc.leg.swelling'),
                          title   = 'Unique Wells Score Components')
existing$roc.perc$plot
## Combine and tabulate the AUC
## rbind(logistic$roc.physiology$plot.auc,
##       logistic$roc.physiology.cat$plot.auc,
##       logistic$roc.presenting$plot.auc,
##       logistic$roc.other$plot.auc,
##       logistic$roc.med.hist$plot.auc) %>%
##     ## dplyr::select(-c(x, y)) %>%
##     kable(digits = 3,
##           caption = 'Area Under the Curve (AUC) statistics of predictor variables')
## Combine and tabulate
rbind(logistic$roc.physiology$summary.stats,
      logistic$roc.physiology.cat$summary.stats,
      logistic$roc.presenting$summary.stats,
      logistic$roc.other$summary.stats,
      logistic$roc.med.hist$summary.stats,
      existing$roc.delphi$summary.stats,
      existing$roc.simplified$summary.stats,
      existing$roc.wells$summary.stats,
      existing$roc.perc$summary.stats) %>%
    arrange(Term) %>%
    ## dplyr::select(`-PPV`, `-NPV`) %>%
    kable(digits  = 3,
          caption = 'Summary Statistics for Univariable logistic regression, threshold for dichotomisation is p > 0.5')

```

#### Saturated Regression

In a situation where you are likely to have information on all possible variables to hand it makes sense to use all  information that is available even if it only improves the overall fit of a model by a small fraction.  To this end a saturated logistic regression model including all variables in their raw, uncategroised format (which preserves the maximum amount of information) has been tested for its performance.

**NB** - History of IV Drug use and Long-haul travel have explicitly been excluded due to problems, this may be rectified in the future.

```{r results_logistic_regression_multi_summary, echo = FALSE, cache = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 10, results = 'markup', eval = TRUE}
to.sum <- logistic$saturated$tidied %>%
          dplyr::select(term, estimate, lci, uci, p.value) %>%
          dplyr::filter(term != '(Intercept)')
ggplot(to.sum, aes(term, estimate, colour = term)) +
    geom_point() + geom_errorbar(aes(ymin = lci, ymax = uci)) +
    coord_flip() + geom_hline(yintercept = 0) +
    xlab('Predictor') + ylab('Estimate') +
    ggtitle('Point Estimate and 95% CI for Univariable Logistic Regression') +
    theme_bw() + theme(legend.position = 'none')
names(to.sum) <- c('Term', 'Estimate', 'Lower CI', 'Upper CI', 'P-Value')
kable(to.sum,
      caption = 'Point estimates, 95% CIs and p-values for Univariable Regression')
rm(to.sum)

```

```{r results_logistic_regression_multi_roc, echo = FALSE, cache = FALSE, warning = FALSE, message = FALSE, fig.width = 10, fig.height = 10, results = 'markup', eval = TRUE}
logistic$saturated$roc
## logistic$saturated$summary.stats

```
