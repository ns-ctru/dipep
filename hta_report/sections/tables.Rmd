## Tables

```{r table_prep, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
n.diagnosed.dvt <- dplyr::filter(dipep, group == 'Diagnosed DVT') %>% nrow()
n.diagnosed.pe  <- dplyr::filter(dipep, group == 'Diagnosed PE') %>% nrow()
n.non.recruited <- dplyr::filter(dipep, group == 'Non recruited') %>% nrow()
n.suspected.pe  <- dplyr::filter(dipep, group == 'Suspected PE') %>% nrow()
header.cohort   <- c('',
                     '',
                     paste0('Diagnosed DVT (', n.diagnosed.dvt, ')'),
                     paste0('Diagnosed PE (',  n.diagnosed.pe, ')'),
                     paste0('Non recruited (', n.non.recruited, ')'),
                     paste0('Suspected PE (',  n.suspected.pe, ')'))

```

> ADD TABLE HERE WITH COLUMNS FOR EACH COHORT AND ROWS FOR THE FOLLOWING CHARACTERISTICS: MEAN AGE, ETHNIC GROUP, MARITAL STATUS, EMPLOYMENT STATUS, GRAVIDITY (NUMBER OF PREVIOUS PREGNANCIES), PROPORTION IN EACH TRIMESTER AND POST-PARTUM

```{r table_recruitment_demographics1, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
to.table <- dplyr::select(dipep,
                          screening,
                          group,
                          age,
                          ethnicity,
                          marital.status,
                          employment,
                          pregnancies.over,
                          pregnancies.under,
                          trimester) %>%
    mutate(previous.pregnancies = pregnancies.under + pregnancies.over) %>%
    gather(key = response, value = value, age:previous.pregnancies)
## This is not a 'natural' table generated by cross-tabulating two variables it is a mixture
## of this and summary statistics, this necessitates building the table as components which
## then need combining.
##
## N and Age
table.recruitment.demographics1.age <- to.table %>%
                                       dplyr::filter(response == 'age') %>%
                                       group_by(group) %>%
                                       summarise(n = sum(!is.na(value)),
                                                 mean = mean(as.numeric(value), na.rm = TRUE),
                                                 sd   = sd(as.numeric(value), na.rm = TRUE)) %>%
                                       ungroup() %>%
                                       mutate(mean_sd = paste0(formatC(mean, format = 'f', digits = digits),
                                                               ' (',
                                                               formatC(sd, format = 'f', digits = digits),
                                                               ')'),
                                              percent = case_when(.$group == 'Diagnosed DVT' ~ (100 * .$n) / n.diagnosed.dvt,
                                                                  .$group == 'Diagnosed PE' ~ (100 * .$n) / n.diagnosed.pe,
                                                                  .$group == 'Non recruited' ~ (100 * .$n) / n.non.recruited,
                                                                  .$group == 'Suspected PE' ~ (100 * .$n) / n.suspected.pe),
                                              n_percent = paste0(formatC(n, format = 'f', digits = 0),
                                                                 ' (',
                                                                 formatC(percent, format = 'f', digits = digits.percent),
                                                                 '%)'))%>%
                                       dplyr::select(-mean, -sd, -percent, -n) %>%
                                       gather(key = statistic, value = value, mean_sd:n_percent) %>%
                                       spread(key = group, value = value) %>%
                                       mutate(statistic = case_when(.$statistic == 'mean_sd'   ~ 'Mean (SD)',
                                                                    .$statistic == 'n_percent' ~ 'N (%)'),
                                              component = 'Age')
## Ethnicity
table.recruitment.demographics1.ethnicity <- to.table %>%
                                             dplyr::filter(response == 'ethnicity') %>%
                                             group_by(group, value) %>%
                                             summarise(n = n()) %>%
                                             ungroup() %>%
                                             mutate(percent   = case_when(.$group == 'Diagnosed DVT' ~ (100 * .$n) / n.diagnosed.dvt,
                                                                          .$group == 'Diagnosed PE' ~ (100 * .$n) / n.diagnosed.pe,
                                                                          .$group == 'Non recruited' ~ (100 * .$n) / n.non.recruited,
                                                                          .$group == 'Suspected PE' ~ (100 * .$n) / n.suspected.pe),
                                                    n_percent = paste0(formatC(n, format = 'f', digits = 0),
                                                                       ' (',
                                                                       formatC(percent, format = 'f', digits = digits.percent),
                                                                       '%)')) %>%
                                             dplyr::select(-n, -percent) %>%
                                             spread(key = group, value = n_percent) %>%
                                             mutate(component = 'Ethnicity',
                                                    value     = ifelse(is.na(value),
                                                                       yes = 'Missing',
                                                                       no  = value))
names(table.recruitment.demographics1.ethnicity) <- gsub('value', 'statistic', names(table.recruitment.demographics1.ethnicity))
## Marital Status
table.recruitment.demographics1.marital <- to.table %>%
                                           dplyr::filter(response == 'marital.status') %>%
                                           group_by(group, value) %>%
                                           summarise(n = n()) %>%
                                           ungroup() %>%
                                           mutate(percent   = case_when(.$group == 'Diagnosed DVT' ~ (100 * .$n) / n.diagnosed.dvt,
                                                                        .$group == 'Diagnosed PE' ~ (100 * .$n) / n.diagnosed.pe,
                                                                        .$group == 'Non recruited' ~ (100 * .$n) / n.non.recruited,
                                                                        .$group == 'Suspected PE' ~ (100 * .$n) / n.suspected.pe),
                                                  n_percent = paste0(formatC(n, format = 'f', digits = 0),
                                                                     ' (',
                                                                     formatC(percent, format = 'f', digits = digits.percent),
                                                                     '%)')) %>%
                                           dplyr::select(-n, -percent) %>%
                                           spread(key = group, value = n_percent) %>%
                                           mutate(component = 'Marital Status',
                                                  value     = case_when(is.na(.$value)          ~ 'Missing',
                                                                        .$value == 'cohabiting' ~ 'Cohabiting',
                                                                        .$value == 'married' ~ 'Married',
                                                                        .$value == 'single' ~ 'Single'))
names(table.recruitment.demographics1.marital) <- gsub('value', 'statistic', names(table.recruitment.demographics1.marital))
## Employment Status
table.recruitment.demographics1.employment <- to.table %>%
                                              dplyr::filter(response == 'employment') %>%
                                              group_by(group, value) %>%
                                              summarise(n = n()) %>%
                                              ungroup() %>%
                                              mutate(percent   = case_when(.$group == 'Diagnosed DVT' ~ (100 * .$n) / n.diagnosed.dvt,
                                                                           .$group == 'Diagnosed PE' ~ (100 * .$n) / n.diagnosed.pe,
                                                                           .$group == 'Non recruited' ~ (100 * .$n) / n.non.recruited,
                                                                           .$group == 'Suspected PE' ~ (100 * .$n) / n.suspected.pe),
                                                     n_percent = paste0(formatC(n, format = 'f', digits = 0),
                                                                     ' (',
                                                                     formatC(percent, format = 'f', digits = digits),
                                                                     '%)')) %>%
                                              dplyr::select(-n, -percent) %>%
                                              spread(key = group, value = n_percent) %>%
                                              mutate(component = 'Employment Status',
                                                     value     = case_when(is.na(.$value)   ~ 'Missing',
                                                                           .$value == 'Yes' ~ 'Employed',
                                                                           .$value == 'No'  ~ 'Unemployed'))
names(table.recruitment.demographics1.employment) <- gsub('value', 'statistic', names(table.recruitment.demographics1.employment))
## Previous Pregnancies
table.recruitment.demographics1.previous <- to.table %>%
                                            dplyr::filter(response %in% c('pregnancies.under', 'pregnancies.over')) %>%
                                            group_by(group, response, value) %>%
                                            summarise(n = n()) %>%
                                            ungroup() %>%
                                            mutate(percent   = case_when(.$group == 'Diagnosed DVT' ~ (100 * .$n) / n.diagnosed.dvt,
                                                                         .$group == 'Diagnosed PE' ~ (100 * .$n) / n.diagnosed.pe,
                                                                         .$group == 'Non recruited' ~ (100 * .$n) / n.non.recruited,
                                                                         .$group == 'Suspected PE' ~ (100 * .$n) / n.suspected.pe),
                                                   n_percent = paste0(formatC(n, format = 'f', digits = 0),
                                                                      ' (',
                                                                      formatC(percent, format = 'f', digits = digits.percent),
                                                                      '%)')) %>%
                                            dplyr::select(-n, -percent) %>%
                                            spread(key = group, value = n_percent) %>%
                                            mutate(response = case_when(.$response == 'pregnancies.over' ~ 'Pregnancies > 24 weeks',
                                                                        .$response == 'pregnancies.under' ~ 'Pregnancies < 24 weeks'),
                                                   value     = case_when(is.na(.$value)   ~ 'Missing',
                                                                         !is.na(.$value)  ~ .$value))
names(table.recruitment.demographics1.previous) <- gsub('value', 'statistic', names(table.recruitment.demographics1.previous))
names(table.recruitment.demographics1.previous) <- gsub('response', 'component', names(table.recruitment.demographics1.previous))
## Trimester
table.recruitment.demographics1.trimester <- to.table %>%
                                             dplyr::filter(response == 'trimester') %>%
                                             group_by(group, value) %>%
                                             summarise(n = n()) %>%
                                             ungroup() %>%
                                             mutate(percent   = case_when(.$group == 'Diagnosed DVT' ~ (100 * .$n) / n.diagnosed.dvt,
                                                                          .$group == 'Diagnosed PE' ~ (100 * .$n) / n.diagnosed.pe,
                                                                          .$group == 'Non recruited' ~ (100 * .$n) / n.non.recruited,
                                                                          .$group == 'Suspected PE' ~ (100 * .$n) / n.suspected.pe),
                                                     n_percent = paste0(formatC(n, format = 'f', digits = 0),
                                                                        ' (',
                                                                        formatC(percent, format = 'f', digits = digits),
                                                                        '%)')) %>%
                                             dplyr::select(-n, -percent) %>%
                                             spread(key = group, value = n_percent) %>%
                                             mutate(component = 'Gestational Age',
                                                   value     = case_when(is.na(.$value)   ~ 'Missing',
                                                                         !is.na(.$value)  ~ .$value))
names(table.recruitment.demographics1.trimester) <- gsub('value', 'statistic', names(table.recruitment.demographics1.trimester))
## Bind into one table
table.recruitment.demographics1 <- rbind(table.recruitment.demographics1.age,
                                         table.recruitment.demographics1.ethnicity,
                                         table.recruitment.demographics1.marital,
                                         table.recruitment.demographics1.employment,
                                         table.recruitment.demographics1.previous,
                                         table.recruitment.demographics1.trimester)


```

> ADD TABLE HERE WITH COLUMNS FOR RECRUITED AND NON RECRUITED WITH SUSPECTED PE, AND ROWS FOR MEAN BMI, PAST HISTORY OF THROMBOSIS, PROPOTION WITH MULTIPLE PREGNANCY, PROPORTION WITH THROMBOPROPHYLAXIS, MEAN HEART RATE, MEAN RESP RATE, MEAN OXYGEN SAT, MEAN BLOOD PRESSURE, MEAN TEMPERATURE AND PROPORTION WITH PE IN PRIMARY ANALYSIS

```{r table_recruitment_demographics2, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
```

> ADD TABLE SHOWING EQ5D RESULTS

```{r table_recruitment_eq5d, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
```


> ADD TABLE(S) HERE WITH COLUMNS FOR WOMEN WITH PE AND WOMEN WITHOUT, AND ROWS FOR AGE>35, BMI≥30, SMOKING STATUS, PREVIOUS PREGNANCIES, ANY PREVIOUS PREGNANCY PROBLEMS (YES/NO), THE 7 ITEMS UNDER PREVIOUS MEDICAL HISTORY, ANY OTHER PREVIOUS MEDICAL PROBLEM, EACH TRIMSTER AND POST PARTUM, MULTIPLE PREGNANCY, LONG HAUL TRAVEL, IMMOBILITY, THROMBOTIC EVENTS, OTHER PREGNANCY PROBLEMS (YES/NO), OTHER PREGNANCY PROBLEMS LIMITED TO THOSE IDENTIFIED AS BEING RISK FACTORS FOR PE, AND RECEIVED THROMBOPROPHYLAXIS

```{r table_status_demographics1, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
```

> ADD TABLE(S) HERE WITH COLUMNS FOR WOMEN WITH PE AND WOMEN WITHOUT, AND ROWS FOR EACH OF THE PRESENTING FEATURES, PROPORTION WITH EACH PHYSIOLOGICAL VARIABLE ABNORMAL, CLINICAL SIGNS OF DVT, ECG RESULT, CXR RESULT AND MOST LIKELY DIAGNOSIS (USING THE 3 CATEGORIES I USED FOR THE WELLS SCORE)


```{r table_status_presenting, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
```

> ADD TABLE COMPARING MEAN (SD) OF AGE, BMI AND EACH PHYSIOLOGICAL MEASURE BETWEEN WOMEN WITH AND WITHOUT PE

```{r table_status_demographics2, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
```

> ADD TABLE AND FIGURE OF UNIVARIATE LOGISTIC REGRESSION

```{r table_logistic_table, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
```
