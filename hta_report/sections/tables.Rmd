## Tables

```{r table_prep, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
n.diagnosed.dvt <- dplyr::filter(dipep, group == 'Diagnosed DVT') %>% nrow()
n.diagnosed.pe  <- dplyr::filter(dipep, group == 'Diagnosed PE') %>% nrow()
n.non.recruited <- dplyr::filter(dipep, group == 'Non recruited') %>% nrow()
n.suspected.pe  <- dplyr::filter(dipep, group == 'Suspected PE') %>% nrow()
header.cohort   <- c('',
                     '',
                     paste0('Diagnosed DVT (', n.diagnosed.dvt, ')'),
                     paste0('Diagnosed PE (',  n.diagnosed.pe, ')'),
                     paste0('Non recruited (', n.non.recruited, ')'),
                     paste0('Suspected PE (',  n.suspected.pe, ')'))
digits         <- 3
digits.percent <- digits

```

> ADD TABLE HERE WITH COLUMNS FOR EACH COHORT AND ROWS FOR THE FOLLOWING CHARACTERISTICS: MEAN AGE, ETHNIC GROUP, MARITAL STATUS, EMPLOYMENT STATUS, GRAVIDITY (NUMBER OF PREVIOUS PREGNANCIES), PROPORTION IN EACH TRIMESTER AND POST-PARTUM

**Comments**

* Not explicitly stated but I have opted to include the percentage of observations within each group.
* Not explicitly stated but I have opted to include a 'Missing' category so that percentages total 100.

```{r table_recruitment_demographics1, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
to.table <- dplyr::select(dipep,
                          screening,
                          group,
                          age,
                          ethnicity,
                          marital.status,
                          employment,
                          pregnancies.over,
                          pregnancies.under,
                          trimester) %>%
    mutate(previous.pregnancies = pregnancies.under + pregnancies.over) %>%
    gather(key = response, value = value, age:previous.pregnancies)
## This is not a 'natural' table generated by cross-tabulating two variables it is a mixture
## of this and summary statistics, this necessitates building the table as components which
## then need combining.
##
## N and Age
table_recruitment_demographics1.age <- to.table %>%
                                       dplyr::filter(response == 'age') %>%
                                       group_by(group) %>%
                                       summarise(n = sum(!is.na(value)),
                                                 mean = mean(as.numeric(value), na.rm = TRUE),
                                                 sd   = sd(as.numeric(value), na.rm = TRUE)) %>%
                                       ungroup() %>%
                                       mutate(mean_sd = paste0(formatC(mean, format = 'f', digits = digits),
                                                               ' (',
                                                               formatC(sd, format = 'f', digits = digits),
                                                               ')'),
                                              percent = case_when(.$group == 'Diagnosed DVT' ~ (100 * .$n) / n.diagnosed.dvt,
                                                                  .$group == 'Diagnosed PE' ~ (100 * .$n) / n.diagnosed.pe,
                                                                  .$group == 'Non recruited' ~ (100 * .$n) / n.non.recruited,
                                                                  .$group == 'Suspected PE' ~ (100 * .$n) / n.suspected.pe),
                                              n_percent = paste0(formatC(n, format = 'f', digits = 0),
                                                                 ' (',
                                                                 formatC(percent, format = 'f', digits = digits.percent),
                                                                 '%)')) %>%
                                       dplyr::select(-mean, -sd, -percent, -n) %>%
                                       gather(key = statistic, value = value, mean_sd:n_percent) %>%
                                       spread(key = group, value = value) %>%
                                       mutate(statistic = case_when(.$statistic == 'mean_sd'   ~ 'Mean (SD)',
                                                                    .$statistic == 'n_percent' ~ 'N (%)'),
                                              component = 'Age')
## Ethnicity
table_recruitment_demographics1.ethnicity <- to.table %>%
                                             dplyr::filter(response == 'ethnicity') %>%
                                             group_by(group, value) %>%
                                             summarise(n = n()) %>%
                                             ungroup() %>%
                                             mutate(percent   = case_when(.$group == 'Diagnosed DVT' ~ (100 * .$n) / n.diagnosed.dvt,
                                                                          .$group == 'Diagnosed PE' ~ (100 * .$n) / n.diagnosed.pe,
                                                                          .$group == 'Non recruited' ~ (100 * .$n) / n.non.recruited,
                                                                          .$group == 'Suspected PE' ~ (100 * .$n) / n.suspected.pe),
                                                    n_percent = paste0(formatC(n, format = 'f', digits = 0),
                                                                       ' (',
                                                                       formatC(percent, format = 'f', digits = digits.percent),
                                                                       '%)')) %>%
                                             dplyr::select(-n, -percent) %>%
                                             spread(key = group, value = n_percent) %>%
                                             mutate(component = 'Ethnicity',
                                                    value     = ifelse(is.na(value),
                                                                       yes = 'Missing',
                                                                       no  = value))
names(table_recruitment_demographics1.ethnicity) <- gsub('value', 'statistic', names(table_recruitment_demographics1.ethnicity))
## Marital Status
table_recruitment_demographics1.marital <- to.table %>%
                                           dplyr::filter(response == 'marital.status') %>%
                                           group_by(group, value) %>%
                                           summarise(n = n()) %>%
                                           ungroup() %>%
                                           mutate(percent   = case_when(.$group == 'Diagnosed DVT' ~ (100 * .$n) / n.diagnosed.dvt,
                                                                        .$group == 'Diagnosed PE' ~ (100 * .$n) / n.diagnosed.pe,
                                                                        .$group == 'Non recruited' ~ (100 * .$n) / n.non.recruited,
                                                                        .$group == 'Suspected PE' ~ (100 * .$n) / n.suspected.pe),
                                                  n_percent = paste0(formatC(n, format = 'f', digits = 0),
                                                                     ' (',
                                                                     formatC(percent, format = 'f', digits = digits.percent),
                                                                     '%)')) %>%
                                           dplyr::select(-n, -percent) %>%
                                           spread(key = group, value = n_percent) %>%
                                           mutate(component = 'Marital Status',
                                                  value     = case_when(is.na(.$value)          ~ 'Missing',
                                                                        .$value == 'cohabiting' ~ 'Cohabiting',
                                                                        .$value == 'married' ~ 'Married',
                                                                        .$value == 'single' ~ 'Single'))
names(table_recruitment_demographics1.marital) <- gsub('value', 'statistic', names(table_recruitment_demographics1.marital))
## Employment Status
table_recruitment_demographics1.employment <- to.table %>%
                                              dplyr::filter(response == 'employment') %>%
                                              group_by(group, value) %>%
                                              summarise(n = n()) %>%
                                              ungroup() %>%
                                              mutate(percent   = case_when(.$group == 'Diagnosed DVT' ~ (100 * .$n) / n.diagnosed.dvt,
                                                                           .$group == 'Diagnosed PE' ~ (100 * .$n) / n.diagnosed.pe,
                                                                           .$group == 'Non recruited' ~ (100 * .$n) / n.non.recruited,
                                                                           .$group == 'Suspected PE' ~ (100 * .$n) / n.suspected.pe),
                                                     n_percent = paste0(formatC(n, format = 'f', digits = 0),
                                                                     ' (',
                                                                     formatC(percent, format = 'f', digits = digits),
                                                                     '%)')) %>%
                                              dplyr::select(-n, -percent) %>%
                                              spread(key = group, value = n_percent) %>%
                                              mutate(component = 'Employment Status',
                                                     value     = case_when(is.na(.$value)   ~ 'Missing',
                                                                           .$value == 'Yes' ~ 'Employed',
                                                                           .$value == 'No'  ~ 'Unemployed'))
names(table_recruitment_demographics1.employment) <- gsub('value', 'statistic', names(table_recruitment_demographics1.employment))
## Previous Pregnancies
table_recruitment_demographics1.previous <- to.table %>%
                                            dplyr::filter(response %in% c('pregnancies.under', 'pregnancies.over')) %>%
                                            group_by(group, response, value) %>%
                                            summarise(n = n()) %>%
                                            ungroup() %>%
                                            mutate(percent   = case_when(.$group == 'Diagnosed DVT' ~ (100 * .$n) / n.diagnosed.dvt,
                                                                         .$group == 'Diagnosed PE' ~ (100 * .$n) / n.diagnosed.pe,
                                                                         .$group == 'Non recruited' ~ (100 * .$n) / n.non.recruited,
                                                                         .$group == 'Suspected PE' ~ (100 * .$n) / n.suspected.pe),
                                                   n_percent = paste0(formatC(n, format = 'f', digits = 0),
                                                                      ' (',
                                                                      formatC(percent, format = 'f', digits = digits.percent),
                                                                      '%)')) %>%
                                            dplyr::select(-n, -percent) %>%
                                            spread(key = group, value = n_percent) %>%
                                            mutate(response = case_when(.$response == 'pregnancies.over' ~ 'Pregnancies > 24 weeks',
                                                                        .$response == 'pregnancies.under' ~ 'Pregnancies < 24 weeks'),
                                                   value     = case_when(is.na(.$value)   ~ 'Missing',
                                                                         !is.na(.$value)  ~ .$value))
names(table_recruitment_demographics1.previous) <- gsub('value', 'statistic', names(table_recruitment_demographics1.previous))
names(table_recruitment_demographics1.previous) <- gsub('response', 'component', names(table_recruitment_demographics1.previous))
## Trimester
table_recruitment_demographics1.trimester <- to.table %>%
                                             dplyr::filter(response == 'trimester') %>%
                                             group_by(group, value) %>%
                                             summarise(n = n()) %>%
                                             ungroup() %>%
                                             mutate(percent   = case_when(.$group == 'Diagnosed DVT' ~ (100 * .$n) / n.diagnosed.dvt,
                                                                          .$group == 'Diagnosed PE' ~ (100 * .$n) / n.diagnosed.pe,
                                                                          .$group == 'Non recruited' ~ (100 * .$n) / n.non.recruited,
                                                                          .$group == 'Suspected PE' ~ (100 * .$n) / n.suspected.pe),
                                                     n_percent = paste0(formatC(n, format = 'f', digits = 0),
                                                                        ' (',
                                                                        formatC(percent, format = 'f', digits = digits),
                                                                        '%)')) %>%
                                             dplyr::select(-n, -percent) %>%
                                             spread(key = group, value = n_percent) %>%
                                             mutate(component = 'Gestational Age',
                                                   value     = case_when(is.na(.$value)   ~ 'Missing',
                                                                         !is.na(.$value)  ~ .$value))
names(table_recruitment_demographics1.trimester) <- gsub('value', 'statistic', names(table_recruitment_demographics1.trimester))
## Bind into one table
table_recruitment_demographics1 <- rbind(table_recruitment_demographics1.age,
                                         table_recruitment_demographics1.ethnicity,
                                         table_recruitment_demographics1.marital,
                                         table_recruitment_demographics1.employment,
                                         table_recruitment_demographics1.previous,
                                         table_recruitment_demographics1.trimester) %>%
                                   group_by(component) %>%
                                   mutate(id       = 1:n(),
                                          Variable = ifelse(id == 1,
                                                            yes = component,
                                                            no  = '')) %>%
                                   ungroup() %>%
                                   dplyr::select(Variable,
                                                 statistic,
                                                 `Diagnosed DVT`,
                                                 `Non recruited`,
                                                 `Diagnosed PE`,
                                                 `Suspected PE`)
kable(table_recruitment_demographics1,
      caption = 'Demographics by recruitment Group')

```

> ADD TABLE HERE WITH COLUMNS FOR RECRUITED AND NON RECRUITED WITH SUSPECTED PE, AND ROWS FOR MEAN BMI, PAST HISTORY OF THROMBOSIS, PROPOTION WITH MULTIPLE PREGNANCY, PROPORTION WITH THROMBOPROPHYLAXIS, MEAN HEART RATE, MEAN RESP RATE, MEAN OXYGEN SAT, MEAN BLOOD PRESSURE, MEAN TEMPERATURE AND PROPORTION WITH PE IN PRIMARY ANALYSIS

**Comments**

* This table *only* summarises the `Suspected PE` and `Non recruited` individuals as per above text.
* Not a 'natural table' that arises from cross-tabulating two variables.
* 'MEAN BLOOD PRESSURE' has been interpreted as both Systolic and Diastolic in the absence of any preference.
* Not explicitly stated but I have opted to include the percentage of observations within each group.
* Not explicitly stated but I have opted to include a 'Missing' category so that percentages total 100.


```{r table_recruitment_demographics2, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
to.table <- dplyr::filter(dipep,
                          group %in% c('Suspected PE', 'Non recruited')) %>%
            dplyr::select(screening, group, first.st, bmi, heart.rate, respiratory.rate, o2.saturation, bp.systolic, bp.diastolic, temperature, thromboprophylaxis, multiple.preg, thrombosis)%>%
            gather(key = response, value = value, first.st:thrombosis)
## Again, this is not a 'natural' table generated by cross-tabulating two variables it is a mixture
## of this and summary statistics, this necessitates building the table as components which
## then need combining.
##
## BMI, Heart Rate, Respiratory Rate, o2 Saturation, bp.systolic, bp.diastolic, temperature
table_recruitment_demographics2.physiology <- to.table %>%
                                              dplyr::filter(response %in% c('bmi',
                                                                            'heart.rate',
                                                                            'respiratory.rate',
                                                                            'o2.saturation',
                                                                            'bp.systolic',
                                                                            'bp.diastolic',
                                                                            'temperature')) %>%
                                              group_by(group, response) %>%
                                              summarise(n = sum(!is.na(value)),
                                                        mean = mean(as.numeric(value), na.rm = TRUE),
                                                        sd   = sd(as.numeric(value), na.rm = TRUE)) %>%
                                              ungroup() %>%
                                              mutate(mean_sd = paste0(formatC(mean, format = 'f', digits = digits),
                                                                      ' (',
                                                                      formatC(sd, format = 'f', digits = digits),
                                                                      ')'),
                                                     percent = case_when(.$group == 'Diagnosed DVT' ~ (100 * .$n) / n.diagnosed.dvt,
                                                                         .$group == 'Diagnosed PE' ~ (100 * .$n) / n.diagnosed.pe,
                                                                         .$group == 'Non recruited' ~ (100 * .$n) / n.non.recruited,
                                                                         .$group == 'Suspected PE' ~ (100 * .$n) / n.suspected.pe),
                                                     n_percent = paste0(formatC(n, format = 'f', digits = 0),
                                                                        ' (',
                                                                        formatC(percent, format = 'f', digits = digits.percent),
                                                                        '%)')) %>%
                                              dplyr::select(-mean, -sd, -percent, -n) %>%
                                              gather(key = statistic, value = value, mean_sd:n_percent) %>%
                                              spread(key = group, value = value) %>%
                                              mutate(statistic = case_when(.$statistic == 'mean_sd'   ~ 'Mean (SD)',
                                                                           .$statistic == 'n_percent' ~ 'N (%)'),
                                              response  = case_when(.$response == 'bmi' ~ 'BMI (kg/m^2)',
                                                                    .$response == 'bp.diastolic' ~ 'Systolic Blood Pressure (mmHg)',
                                                                    .$response == 'bp.systolic' ~ 'Diastolic Blood Pressure (mmHg)',
                                                                    .$response == 'respiratory.rate' ~ 'Respiratory Rate (breaths/minute)',
                                                                    .$response == 'o2.saturation' ~ 'Oxygen Saturation (%)',
                                                                    .$response == 'heart.rate' ~ 'Heart Rate (bpm)',
                                                                    .$response == 'temperature' ~ 'Temperature (C)'))
## Now the other four components required
table_recruitment_demographics2.other <- to.table %>%
                                         dplyr::filter(response %in% c('first.st',
                                                                       'thromboprophylaxis',
                                                                       'multiple.preg',
                                                                       'thrombosis')) %>%
                                         group_by(group, response, value) %>%
                                         summarise(n = n()) %>%
                                         ungroup() %>%
                                         mutate(value = ifelse(is.na(value),
                                                               yes = 'Missing',
                                                               no  = value),
                                                percent = case_when(.$group == 'Non recruited' ~ (100 * .$n) / n.non.recruited,
                                                                    .$group == 'Suspected PE' ~ (100 * .$n) / n.suspected.pe,
                                                                    .$group == 'Diagnosed PE' ~ (100 * .$n) / n.diagnosed.pe,
                                                                    .$group == 'Diagnosed DVT' ~ (100 * .$n) / n.diagnosed.dvt),
                                                n_percent = paste0(formatC(n, format = 'f', digits = 0),
                                                                   ' (',
                                                                   formatC(percent, format = 'f', digits = digits.percent),
                                                                   '%)'),
                                                component = case_when(.$response == 'first.st' ~ 'Primary Classification',
                                                                      .$response == 'thromboprophylaxis' ~ 'Thromboprophylaxis',
                                                                      .$response == 'multiple.preg' ~ 'Multiple Pregnancy',
                                                                      .$response == 'thrombosis' ~ 'Primary Classification'),
                                                answer    = value) %>%
                                         dplyr::select(-n, -percent, -response, -value) %>%
                                         gather(key = statistic, value = value, n_percent) %>%
                                         spread(key = group, value = value) %>%
                                         dplyr::select(-statistic) %>%
                                         mutate(`Non recruited` = ifelse(is.na(`Non recruited`),
                                                                         yes = '0 (0%)',
                                                                         no  = `Non recruited`),
                                                `Suspected PE` = ifelse(is.na(`Suspected PE`),
                                                                        yes = '0 (0%)',
                                                                        no  = `Suspected PE`))
                                                ## `Diagnosed PE` = ifelse(is.na(`Diagnosed PE`),
                                                ##                                yes = '0 (0%)',
                                                ##                          no  = `Diagnosed PE`),
                                                ## `Diagnosed DVT` = ifelse(is.na(`Diagnosed DVT`),
                                                ##                                yes = '0 (0%)',
                                                ##                          no  = `Diagnosed DVT`)
names(table_recruitment_demographics2.other) <- c('response', 'statistic', 'Non recruited', 'Susp')
## Bind into one table and sort formatting
table_recruitment_demographics2 <- rbind(table_recruitment_demographics2.other) %>%
                                   group_by(response) %>%
                                   mutate(id       = 1:n(),
                                          Variable = ifelse(id == 1,
                                                            yes = response,
                                                            no  = '')) %>%
                                   ungroup() %>%
                                   dplyr::select(Variable,
                                                 statistic,
                                                 ## `Diagnosed DVT`,
                                                 `Non recruited`,
                                                 ## `Diagnosed PE`,
                                                 `Suspected PE`)
kable(table_recruitment_demographics1,
      caption = 'Demographics by recruitment Group')


```

> ADD TABLE SHOWING EQ5D RESULTS

```{r table_recruitment_eq5d, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
```


> ADD TABLE(S) HERE WITH COLUMNS FOR WOMEN WITH PE AND WOMEN WITHOUT, AND ROWS FOR AGE>35, BMI≥30, SMOKING STATUS, PREVIOUS PREGNANCIES, ANY PREVIOUS PREGNANCY PROBLEMS (YES/NO), THE 7 ITEMS UNDER PREVIOUS MEDICAL HISTORY, ANY OTHER PREVIOUS MEDICAL PROBLEM, EACH TRIMSTER AND POST PARTUM, MULTIPLE PREGNANCY, LONG HAUL TRAVEL, IMMOBILITY, THROMBOTIC EVENTS, OTHER PREGNANCY PROBLEMS (YES/NO), OTHER PREGNANCY PROBLEMS LIMITED TO THOSE IDENTIFIED AS BEING RISK FACTORS FOR PE, AND RECEIVED THROMBOPROPHYLAXIS

```{r table_status_demographics1, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
```

> ADD TABLE(S) HERE WITH COLUMNS FOR WOMEN WITH PE AND WOMEN WITHOUT, AND ROWS FOR EACH OF THE PRESENTING FEATURES, PROPORTION WITH EACH PHYSIOLOGICAL VARIABLE ABNORMAL, CLINICAL SIGNS OF DVT, ECG RESULT, CXR RESULT AND MOST LIKELY DIAGNOSIS (USING THE 3 CATEGORIES I USED FOR THE WELLS SCORE)


```{r table_status_presenting, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
```

> ADD TABLE COMPARING MEAN (SD) OF AGE, BMI AND EACH PHYSIOLOGICAL MEASURE BETWEEN WOMEN WITH AND WITHOUT PE

```{r table_status_demographics2, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
```

> ADD TABLE AND FIGURE OF UNIVARIATE LOGISTIC REGRESSION

```{r table_logistic_table, echo = FALSE, warning = FALSE, messages = FALSE, eval = TRUE}
```
